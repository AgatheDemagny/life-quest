<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>LIFE QUEST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Space+Grotesk:wght@600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#0F0F11">
</head>
<body>
  <div class="game">

    <!-- LOADING -->
    <div id="loadingScreen" class="loading hidden">
      <div class="loading-card">
        <div class="spinner"></div>
        <div class="loading-text">Chargementâ€¦</div>
      </div>
    </div>

    <!-- LOGIN -->
     <div id="loginScreen" class="hidden">
      <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
      <div class="card">
        <h2>Connexion</h2>

        <input type="email" id="authEmail" placeholder="Email">
        <input type="password" id="authPassword" placeholder="Mot de passe">

        <div class="actions">
          <button id="btnLogin" class="ghost">Se connecter</button>
          <button id="btnSignup" class="ghost">CrÃ©er un compte</button>
        </div>

        <p class="hint" id="authStatus">Il faut Ãªtre connectÃ© Ã  un compte pour pouvoir utiliser l'app</p>
      </div>
    </div>

    <!-- ONBOARDING : pseudo -->
    <section id="onboardingScreen" class="hidden">
      <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
      <div class="card">
        <h2>Choisis ton pseudo</h2>
        <input id="playerNameInput" type="text" placeholder="Ex : Bob" maxlength="24" />
        <button id="startBtn" class="primary btn-block">Commencer</button>
      </div>
    </section>

    <!-- HOME -->
    <section id="homeScreen" class="hidden stack">
      <header class="topbar">
        <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
        <button id="openSettingsBtn" class="icon-btn" aria-label="ParamÃ¨tres">âš™ï¸</button>
      </header>

      <!-- Onglet stats -->
      <div id="homeStats">
        <div class="card">
          <h3>Joueur</h3>
          <p><strong>Pseudo</strong> <span id="playerName"></span></p>
          <p><strong>Niveau</strong> <span id="globalLevel" class="level"></span></p>
          <p><strong>XP totale</strong> <span id="globalXp" class="reward"></span></p>
          <div class="stat-row">
            <span class="stat-label"><strong>Temps passÃ©</strong></span>
            <span class="stat-value" id="globalTimePretty">00h00mn</span>
          </div>
        </div>
      </div>

      <div id="homeObjectives">
        <div class="card">
          <h3>Objectifs</h3>

          <!-- ================= HEBDOMADAIRE ================= -->
          <div class="subsection">
            <h4><span class="badge-right">Hebdomadaire</span></h4>
            <div class="mode-label">Mode</div>

            <div class="segmented" id="weekLoadPicker">
              <button data-load="chill">Chill</button>
              <button data-load="focus" class="active">Focus</button>
              <button data-load="boss">Boss</button>
            </div>

            <div class="stat-row">
              <span class="stat-label">Progression</span>
              <span class="stat-value">
                <span id="weekXp"></span>/<span id="weekGoal"></span> XP
              </span>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" id="weekProgress">0%</div>
            </div>
          </div>

          <!-- ================= MENSUEL ================= -->
          <div class="subsection">
            <h4><span class="badge-right">Mensuel</span></h4>

            <div class="stat-row">
              <span class="stat-label">Progression</span>
              <span class="stat-value">
                <span id="monthXp"></span>/<span id="monthGoal"></span> XP
              </span>
            </div>

            <div class="progress-bar">
              <div class="progress-fill" id="monthProgress">0%</div>
            </div>
          </div>

          <div class="subsection">
            <h4><span class="badge-right">Historique</span></h4>

            <button id="openPerformanceBtn" class="ghost btn-block">
              ğŸƒğŸ½â€â™€ï¸ Performances passÃ©es
            </button>
          </div>

        </div>
      </div>

      <!-- Onglet mondes -->
      <div id="homeWorlds">
        <div class="card">
          <h3>Parcourir les mondes</h3>
          <div id="worldsList" class="worlds-grid"></div>
          <button class="btn-block" id="openAddWorldBtn">ğŸŒ„ Ajouter un monde</button>
        </div>

        <div id="addWorldModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
          <div class="modal-content card form-card">
            <h3>Ajouter un monde</h3>

            <label>Nom du monde</label>
            <input id="worldNameInput" placeholder="Ex : Sport" />

            <label>IcÃ´ne</label>
            <input id="worldIconInput" placeholder="Ex : ğŸƒ" />

            <label>RÃ¨gle XP</label>
            <p class="input-hint">
              Par dÃ©faut 1XP = 1mn
            </p>
            <div class="inline">
              <input id="minutesBaseInput" type="number" min="1" inputmode="numeric" placeholder="Minutes" />
              <span>=</span>
              <input id="xpBaseInput" type="number" min="1" inputmode="numeric" placeholder="XP" />
            </div>

            <div class="actions">
              <button id="createWorldBtn" class="primary">Ajouter</button>
              <button id="cancelWorldBtn" class="ghost" type="button">Annuler</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORLD -->
    <section id="worldScreen" class="hidden stack">
      <header class="topbar">
        <button id="backHomeBtn" class="icon-btn" aria-label="Retour">â†</button>
        <h2 id="worldHeaderTitle"></h2>
        <button id="worldQuickSettingsBtn" class="icon-btn" aria-label="ParamÃ¨tres monde">âš™ï¸</button>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="worldStats">ğŸ“Š Stats</button>
        <button class="tab-btn" data-tab="worldInput">â±ï¸ Saisie</button>
        <button class="tab-btn" data-tab="worldObjectives">ğŸ¯ Objectifs</button>
      </div>

      <div id="worldStats" class="tab-panel">
        <div class="card">
          <h3>Statistiques du monde</h3>
          <p><strong>Niveau</strong> <span id="worldLevel"></span></p>
          <p><strong>XP totale</strong> <span id="worldTotalXp"></span></p>
          <div class="stat-row">
            <span class="stat-label"><strong>Temps</strong></span>
            <span class="stat-value" id="worldTotalTime">00h00mn</span>
          </div>
          <p><strong>XP de la semaine</strong> <span id="worldWeekXp"></span></p>
          <p><strong>RÃ¨gle XP</strong> <span id="worldRuleText"></span></p>
        </div>
      </div>


      <div id="worldInput" class="tab-panel hidden">
        <div class="card">
          <h3>Saisir un temps</h3>
          <input id="timeMinutesInput" type="number" min="1" inputmode="numeric" placeholder="Minutes (ex : 45)" />
          <button class="primary btn-block" id="validateTimeBtn">Saisir</button>
          <button class="ghost btn-block" id="openPastTimeBtn">ğŸ•°ï¸ Saisir un temps passÃ©</button>
          <div id="pastTimeBox" class="card subtle form-card hidden">
            <label>Temps (minutes)</label>
            <input id="pastMinutesInput" type="number" min="1" inputmode="numeric" placeholder="Minutes (ex : 45)" />

            <label>Date</label>
            <input id="pastDateInput" type="date" />

            <label>Heure</label>
            <input id="pastTimeInput" type="time" step="60" />

            <div class="inline">
              <button class="primary btn-block" id="savePastTimeBtn">Ajouter ce temps</button>
              <button class="ghost btn-block" id="cancelPastTimeBtn" type="button">Annuler</button>
            </div>

            <p class="hint">La saisie sera ajoutÃ©e Ã  lâ€™historique Ã  la bonne date.</p>
          </div>
          <p class="hint" id="timePreview"></p>
        </div>

        <div class="card">
          <h3>Historique des saisies</h3>
          <div id="entriesList"></div>
          <p class="hint">Suppression possible uniquement dans les 24h</p>
        </div>
      </div>
      <div id="worldObjectives" class="tab-panel hidden">
        <div class="card">
          <h3>Objectifs du monde</h3>
          <div id="objectivesList"></div>
        </div>

        <div class="card form-card">
          <h3>Ajouter un objectif</h3>

          <label>Type de quÃªte</label>
          <div class="hint">
            ğŸ–ï¸ Exploit : QuÃªte unique<br>
            ğŸ”® Rituel : QuÃªte rÃ©alisable Ã  l'infini<br>
            ğŸ§—ğŸ¼ Ascension : QuÃªte par palier<br>
          </div>
          <select id="objectiveTypeSelect">
            <option value="unique">ğŸ–ï¸â€‹ Exploit</option>
            <option value="repeatable">ğŸ”®â€‹ Rituel</option>
            <option value="milestone">ğŸ§—ğŸ¼â€‹ Ascension</option>
          </select>

          <div id="objectiveFieldsRepeatable">
            <label>Nom</label>
            <input id="objNameInput" placeholder="Ex : Aller courir" />
            <label>RÃ©compense associÃ©e (XP)</label>
            <input id="objXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
          </div>

          <div id="objectiveFieldsUnique" class="hidden">
            <label>Nom</label>
            <input id="objNameUniqueInput" placeholder="Ex : Finir un marathon" />
            <label>RÃ©compense associÃ©e (XP)</label>
            <input id="objXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
          </div>

          <div id="objectiveFieldsMilestone" class="hidden">
            <label>Nom (en 2 parties)</label>
            <div class="inline">
              <input id="milestonePrefixInput" placeholder="Ex : Lire" />
              <input id="milestoneSuffixInput" placeholder="livres" />
            </div>

            <div class="card subtle form-card">
              <p class="hint">Ajoute les paliers Ã  atteindre dans lâ€™ordre (ex : 1 puis 5 puis 10).</p>
              <div class="inline">
                <input id="milestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier" />
                <input id="milestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP rÃ©compense" />
              </div>
              <button id="addMilestoneStepBtn" class="ghost">â• Ajouter palier</button>
              <div id="milestoneStepsPreview" class="steps-preview"></div>
            </div>

            <button id="createMilestoneObjectiveBtn" class="primary btn-block">Ajouter lâ€™objectif palier</button>
          </div>

          <button class="primary btn-block" id="createObjectiveBtn">Ajouter l'objectif</button>
        </div>
        <!-- MODAL: Modifier objectif -->
        <div id="editObjectiveModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
          <div class="modal-content card form-card">
            <h3 id="editObjectiveTitle">Modifier lâ€™objectif</h3>
            <div id="editObjectiveInfo" class="hint" style="margin-bottom:10px;"></div>
            <label>Type de quÃªte</label>
            <div class="hint">
              ğŸ–ï¸ Exploit : QuÃªte unique<br>
              ğŸ”® Rituel : QuÃªte rÃ©alisable Ã  l'infini<br>
              ğŸ§—ğŸ¼ Ascension : QuÃªte par palier<br>
            </div>
            <select id="editObjectiveTypeSelect">
              <option value="unique">ğŸ–ï¸â€‹ Exploit</option>
              <option value="repeatable">ğŸ”®â€‹ Rituel</option>
              <option value="milestone">ğŸ§—ğŸ¼â€‹ Ascension</option>
            </select>
            <div id="editObjectiveFieldsRepeatable">
              <label>Nom</label>
              <input id="editObjNameInput" placeholder="Ex : Aller courir" />
              <label>RÃ©compense associÃ©e (XP)</label>
              <input id="editObjXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
            </div>

            <div id="editObjectiveFieldsUnique" class="hidden">
              <label>Nom</label>
              <input id="editObjNameUniqueInput" placeholder="Ex : Finir un marathon" />
              <label>RÃ©compense associÃ©e (XP)</label>
              <input id="editObjXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
            </div>

            <div id="editObjectiveFieldsMilestone" class="hidden">
              <label>Nom (en 2 parties)</label>
              <div class="inline">
                <input id="editMilestonePrefixInput" placeholder="Ex : Lire" />
                <input id="editMilestoneSuffixInput" placeholder="Ex : livres" />
              </div>

              <div class="card subtle form-card">
                <p class="hint">Les paliers prÃ©cÃ©demment crÃ©Ã©s ne sont pas modifiables</p>
                <div class="inline">
                  <input id="editMilestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier (ex : 1)" />
                  <input id="editMilestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP (ex : 10)" />
                </div>
                <button id="editAddMilestoneStepBtn" class="ghost">â• Ajouter palier</button>
                <div id="editMilestoneStepsPreview" class="steps-preview"></div>
              </div>

              <button id="editSaveMilestoneBtn" class="primary btn-block">Modifier lâ€™objectif palier</button>
            </div>
            <div class="actions">
              <button id="editSaveObjectiveBtn" class="primary">Modifier l'objectif</button>
              <button id="editCancelObjectiveBtn" class="ghost" type="button">Annuler</button>
            </div>
            <button id="editDeleteObjectiveBtn" class="danger-btn btn-block" type="button">
              âŒâ€‹ Supprimer lâ€™objectif
            </button>
          </div>
        </div>

      </div>
    </section>
    
    <!-- Onglet performances -->
    <section id="performanceScreen" class="hidden">
      <header class="topbar">
        <button id="backFromPerformanceBtn" class="icon-btn" aria-label="Retour">â†</button>
        <h2>ğŸƒğŸ½â€â™€ï¸â€â¡ï¸ Performances passÃ©es</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="perfWeek">Semaine</button>
        <button class="tab-btn" data-tab="perfMonth">Mois</button>
      </div>

      <div id="perfWeek" class="tab-panel">
        <div class="card">
          <h3>Historique</h3>
          <div id="perfWeekList"></div>
        </div>
      </div>

      <div id="perfMonth" class="tab-panel hidden">
        <div class="card">
          <h3>Historique</h3>
          <div id="perfMonthList"></div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsScreen" class="hidden stack">
      <header class="topbar">
        <button id="backFromSettingsBtn" class="icon-btn" aria-label="Retour">â†</button>
        <h2>âš™ï¸ ParamÃ¨tres</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="card">
        <h3>Compte</h3>

        <p><strong>Pseudo</strong> <span id="accountPseudoLine">â€”</span></p>
        <p><strong>Email</strong> <span id="accountEmailLine">â€”</span></p>

        <button id="btnLogout" class="danger-btn btn-block">Se dÃ©connecter</button>
      </div>

      <div class="card">
        <h3>Objectifs</h3>
        <label>Objectifs hebdo (XP)</label>
        <div class="grid-3">
          <div>
            <div class="hint">Mode Chill</div>
            <input id="weekGoalChillInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Mode Focus</div>
            <input id="weekGoalFocusInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Mode Boss</div>
            <input id="weekGoalBossInput" type="number" min="1" inputmode="numeric" />
          </div>
        </div>

        <label>Objectif mensuel (XP)</label>
        <input id="monthGoalInput" type="number" min="1" inputmode="numeric" />

        <div class="actions">
          <button class="primary" id="saveGoalsBtn">Modifier</button>
          <button type="button" class="ghost" id="resetGoalsBtn">Par dÃ©faut</button>
        </div>

      </div>

      <div class="card">
        <h3>Mondes</h3>

        <div class="subsection">
          <h4>Mondes actifs</h4>
          <div id="manageWorldsActiveList"></div>
        </div>

        <div class="subsection" style="margin-top:12px;">
          <h4>Mondes archivÃ©s</h4>
          <div id="manageWorldsArchivedList"></div>
        </div>
      </div>

      <div class="card danger">
        <h3>RÃ©initialiser le jeu</h3>
        <p class="hint">Cela entraÃ®ne la suppression de toutes tes donnÃ©es.</p>
        <button id="resetGameBtn" class="btn-block danger-btn">ğŸ‘¾ RÃ©initialiser le jeu</button>
      </div>
    </section>

    <!-- POPUP -->
    <div id="popup"></div>

  </div>

  <!-- CELEBRATION MODAL -->
  <div id="celebrationModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content card celebration-card">
      <div class="celebration-emoji" id="celebrationEmoji">ğŸ‰</div>
      <h2 id="celebrationTitle">Objectif atteint !</h2>
      <p class="hint" id="celebrationMsg">Bravo ğŸ‘‘</p>
      <button id="celebrationOkBtn" class="btn-block">Trop bien ğŸŒˆâœ¨</button>
    </div>
  </div>

  <!-- DIALOG (remplace alert/confirm) -->
  <div id="dialogModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content card dialog-card">
      <h3 id="dialogTitle">Confirmation</h3>
      <p id="dialogMessage" class="dialog-message"></p>

      <div id="dialogInputWrap" class="dialog-input-wrap hidden">
        <input id="dialogInput" type="text" class="time-input" />
      </div>

      <div class="actions">
        <button id="dialogCancelBtn" class="ghost" type="button">Annuler</button>
        <button id="dialogAltBtn" class="ghost" type="button" style="display:none;"></button>
        <button id="dialogOkBtn" type="button">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Firebase Core -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQKK5pD8_h_Pg1-48spGBGzxZm1fgiHzs",
      authDomain: "joue-ma-vie.firebaseapp.com",
      projectId: "joue-ma-vie",
      storageBucket: "joue-ma-vie.firebasestorage.app",
      messagingSenderId: "351248369885",
      appId: "1:351248369885:web:7a2191fab089c60304b334"
    };

    firebase.initializeApp(firebaseConfig);
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
  <script src="js/main.js"></script>
  <div style="opacity:0.6;font-size:12px;text-align:center;margin-top:10px;">
  Version: <span id="appVersion"></span>
  </div>
</body>
</html>

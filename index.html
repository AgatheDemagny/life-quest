<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>LIFE QUEST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#80586D">
</head>
<body>
  <div class="game">

    <!-- ONBOARDING : pseudo -->
    <section id="onboardingScreen" class="hidden">
      <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
      <div class="card">
        <h2>Choisis ton pseudo</h2>
        <input id="playerNameInput" type="text" placeholder="Ex : Agathe" maxlength="24" />
        <button id="startBtn">Commencer</button>
      </div>
    </section>

    <!-- HOME -->
    <section id="homeScreen" class="hidden">
      <header class="topbar">
        <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
        <button id="openSettingsBtn" class="icon-btn" aria-label="Param√®tres">‚öôÔ∏è</button>
      </header>

      <!-- Onglet stats -->
      <div id="homeStats">
        <div class="card">
          <h3>Joueuse</h3>
          <p><strong>Pseudo :</strong> <span id="playerName"></span></p>
          <p><strong>Niveau :</strong> <span id="globalLevel"></span></p>
          <p><strong>XP totale :</strong> <span id="globalXp"></span></p>
          <p><strong>Temps pass√© :</strong> <span id="globalTimeHours"></span> h</p>
        </div>


        <div class="card">
          <h3>Objectifs</h3>

          <div class="subsection">
            <h4>Hebdomadaire</h4>
            <div class="segmented" id="weekLoadPicker">
              <button data-load="busy">Charg√©e</button>
              <button data-load="normal" class="active">Normale</button>
              <button data-load="light">L√©g√®re</button>
            </div>
            <p><span id="weekXp"></span> / <span id="weekGoal"></span> XP</p>
            <div class="progress-bar"><div class="progress-fill" id="weekProgress">0%</div></div>
          </div>

          <div class="subsection" style="margin-top:12px;">
            <h4>Mensuel</h4>
            <p><span id="monthXp"></span> / <span id="monthGoal"></span> XP</p>
            <div class="progress-bar"><div class="progress-fill" id="monthProgress">0%</div></div>
          </div>

          <button id="openPerformanceBtn" class="ghost btn-block">üèÉüèΩ‚Äç‚ôÄÔ∏è‚Äç‚û°Ô∏è Performances pass√©es</button>
        </div>


      <!-- Onglet mondes -->
      <div id="homeWorlds">
        <div class="card">
          <h3>Parcourir les mondes</h3>
          <div id="worldsList" class="worlds-grid"></div>
          <button class="btn-block" id="openAddWorldBtn">üåÑ Ajouter un monde</button>
        </div>

        <div id="addWorldModal" class="modal hidden" role="dialog" aria-modal="true">
          <div class="modal-content card">
            <h3>Cr√©er un monde</h3>

            <label>Nom du monde</label>
            <input id="worldNameInput" placeholder="Ex : Sport" />

            <label>Ic√¥ne (emoji)</label>
            <input id="worldIconInput" placeholder="Ex : üèÉ" />

            <label>R√®gle XP</label>
            <div class="inline">
              <input id="minutesBaseInput" type="number" min="1" inputmode="numeric" placeholder="Minutes" />
              <span>=</span>
              <input id="xpBaseInput" type="number" min="1" inputmode="numeric" placeholder="XP" />
            </div>

            <div class="actions">
              <button id="createWorldBtn">Cr√©er</button>
              <button id="cancelWorldBtn" class="ghost" type="button">Annuler</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORLD -->
    <section id="worldScreen" class="hidden">
      <header class="topbar">
        <button id="backHomeBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2 id="worldHeaderTitle"></h2>
        <button id="worldQuickSettingsBtn" class="icon-btn" aria-label="Param√®tres monde">‚öôÔ∏è</button>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="worldStats">üìä Stats</button>
        <button class="tab-btn" data-tab="worldInput">‚è±Ô∏è Saisie</button>
        <button class="tab-btn" data-tab="worldObjectives">üéØ Objectifs</button>
      </div>

      <div id="worldStats" class="tab-panel">
        <div class="card">
          <h3>Stats</h3>
          <p><strong>Niveau du monde :</strong> <span id="worldLevel"></span></p>
          <p><strong>XP semaine :</strong> <span id="worldWeekXp"></span></p>
          <p><strong>XP totale :</strong> <span id="worldTotalXp"></span></p>
          <p><strong>R√®gle XP :</strong> <span id="worldRuleText"></span></p>
          <p><strong>Temps total :</strong> <span id="worldTotalTime"></span> min</p>
        </div>
      </div>


      <div id="worldInput" class="tab-panel hidden">
        <div class="card">
          <h3>Saisir du temps</h3>
          <input id="timeMinutesInput" type="number" min="1" inputmode="numeric" placeholder="Minutes (ex : 45)" />
          <button class="btn-block" id="validateTimeBtn">Valider</button>
          <p class="hint" id="timePreview"></p>
        </div>

      <div class="card">
        <h3>Historique des saisies</h3>
        <div id="entriesList"></div>
        <p class="hint">Suppression possible uniquement pendant 24h.</p>
    </div>
  </div>
      <div id="worldObjectives" class="tab-panel hidden">
        <div class="card">
          <h3>Objectifs</h3>
          <div id="objectivesList"></div>
        </div>

        <div class="card">
          <h3>Ajouter un objectif</h3>

          <label>Type</label>
          <select id="objectiveTypeSelect">
            <option value="repeatable">üîÅ R√©p√©table</option>
            <option value="milestone">üìà Palier</option>
            <option value="unique">‚≠ê Unique</option>
          </select>

          <div id="objectiveFieldsRepeatable">
            <label>Nom</label>
            <input id="objNameInput" placeholder="Ex : Aller courir" />
            <label>R√©compense (XP)</label>
            <input id="objXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
          </div>

          <div id="objectiveFieldsUnique" class="hidden">
            <label>Nom</label>
            <input id="objNameUniqueInput" placeholder="Ex : Finir un marathon" />
            <label>R√©compense (XP)</label>
            <input id="objXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
          </div>

          <div id="objectiveFieldsMilestone" class="hidden">
            <label>Texte (2 parties)</label>
            <div class="inline">
              <input id="milestonePrefixInput" placeholder="Ex : Lire" />
              <input id="milestoneSuffixInput" placeholder="Ex : livres" />
            </div>

            <div class="card subtle">
              <p class="hint">Ajoute tes paliers dans l‚Äôordre (ex : 1 puis 5 puis 10). Le prochain palier appara√Ætra automatiquement.</p>
              <div class="inline">
                <input id="milestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier (ex : 1)" />
                <input id="milestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP (ex : 10)" />
              </div>
              <button id="addMilestoneStepBtn" class="ghost">‚ûï Ajouter palier</button>
              <div id="milestoneStepsPreview" class="steps-preview"></div>
            </div>

            <button id="createMilestoneObjectiveBtn">Cr√©er l‚Äôobjectif palier</button>
          </div>

          <button class="btn-block" id="createObjectiveBtn">Ajouter</button>
        </div>
      </div>
    </section>
    
    <!-- Onglet performances -->
    <section id="performanceScreen" class="hidden">
      <header class="topbar">
        <button id="backFromPerformanceBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2>üèÉüèΩ‚Äç‚ôÄÔ∏è‚Äç‚û°Ô∏è Performances pass√©es</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="perfWeek">Semaine</button>
        <button class="tab-btn" data-tab="perfMonth">Mois</button>
      </div>

      <div id="perfWeek" class="tab-panel">
        <div class="card">
          <h3>Historique (Semaine)</h3>
          <div id="perfWeekList"></div>
        </div>
      </div>

      <div id="perfMonth" class="tab-panel hidden">
        <div class="card">
          <h3>Historique (Mois)</h3>
          <div id="perfMonthList"></div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsScreen" class="hidden">
      <header class="topbar">
        <button id="backFromSettingsBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2>‚öôÔ∏è Param√®tres</h2>
        <div style="width:40px;"></div>
      </header>

              <div class="card">
          <h3>Compte</h3>
          <p class="hint" id="authStatus">Non connect√©e</p>

          <label>Email</label>
          <input id="authEmail" type="email" placeholder="ex : moi@email.com" autocomplete="email" />

          <label>Mot de passe</label>
          <input id="authPassword" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />

          <div class="actions">
            <button id="btnLogin">Se connecter</button>
            <button id="btnSignup" class="ghost" type="button">Cr√©er un compte</button>
          </div>

          <div class="actions">
            <button id="btnLogout" class="ghost hidden" type="button">Se d√©connecter</button>
          </div>

          <p class="hint">La sauvegarde cloud arrive juste apr√®s (prochaine √©tape).</p>
        </div>

      <div class="card">
        <h3>Objectifs</h3>
        <label>Objectif mensuel (XP)</label>
        <input id="monthGoalInput" type="number" min="1" inputmode="numeric" />

        <label>Objectifs hebdo (XP)</label>
        <div class="grid-3">
          <div>
            <div class="hint">Semaine charg√©e</div>
            <input id="weekGoalBusyInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine normale</div>
            <input id="weekGoalNormalInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine l√©g√®re</div>
            <input id="weekGoalLightInput" type="number" min="1" inputmode="numeric" />
          </div>
        </div>
        <button class="btn-block" id="saveGoalsBtn">Enregistrer</button>
      </div>

      <div class="card">
        <h3>Mondes</h3>
        <div id="manageWorldsList"></div>
      </div>
      <div class="card danger">
        <h3>R√©initialiser</h3>
        <p class="hint">Supprime toutes les donn√©es (pseudo, mondes, XP‚Ä¶).</p>
        <button id="resetGameBtn" class="btn-block danger-btn">üëæ R√©initialiser le jeu</button>
      </div>
    </section>

    <!-- POPUP -->
    <div id="popup"></div>

  </div>

  <!-- DIALOG (remplace alert/confirm) -->
  <div id="dialogModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content card dialog-card">
      <h3 id="dialogTitle">Confirmation</h3>
      <p id="dialogMessage" class="dialog-message"></p>

      <div id="dialogInputWrap" class="dialog-input-wrap hidden">
        <input id="dialogInput" type="text" class="time-input" />
      </div>

      <div class="actions">
        <button id="dialogCancelBtn" class="ghost" type="button">Annuler</button>
        <button id="dialogOkBtn" type="button">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Firebase Core -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQKK5pD8_h_Pg1-48spGBGzxZm1fgiHzs",
      authDomain: "joue-ma-vie.firebaseapp.com",
      projectId: "joue-ma-vie",
      storageBucket: "joue-ma-vie.firebasestorage.app",
      messagingSenderId: "351248369885",
      appId: "1:351248369885:web:7a2191fab089c60304b334"
    };

    firebase.initializeApp(firebaseConfig);
  </script>

  <script src="js/main.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
  <script src="js/main.js"></script>
  <div style="opacity:0.6;font-size:12px;text-align:center;margin-top:10px;">
  Version: <span id="appVersion"></span>
  </div>
</body>
</html>

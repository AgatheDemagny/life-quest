<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>LIFE QUEST</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="icons/icon-192.png">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <meta name="theme-color" content="#80586D">
</head>
<body>
  <div class="game">

    <!-- LOADING -->
    <div id="loadingScreen" class="loading hidden">
      <div class="loading-card">
        <div class="spinner"></div>
        <div class="loading-text">Chargement‚Ä¶</div>
      </div>
    </div>

    <!-- LOGIN -->
     <div id="loginScreen" class="hidden">
      <div class="card">
        <h2>Connexion</h2>

        <input type="email" id="authEmail" placeholder="Email">
        <input type="password" id="authPassword" placeholder="Mot de passe">

        <div class="actions">
          <button id="btnLogin" class="ghost">Se connecter</button>
          <button id="btnSignup" class="ghost">Cr√©er un compte</button>
        </div>

        <p class="hint" id="authStatus">Non connect√©e</p>
      </div>
    </div>

    <!-- ONBOARDING : pseudo -->
    <section id="onboardingScreen" class="hidden">
      <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
      <div class="card">
        <h2>Choisis ton pseudo</h2>
        <input id="playerNameInput" type="text" placeholder="Ex : Agathe" maxlength="24" />
        <button id="startBtn">Commencer</button>
      </div>
    </section>

    <!-- HOME -->
    <section id="homeScreen" class="hidden stack">
      <header class="topbar">
        <img src="icons/banner-1080-420.png" alt="Life Quest" class="app-banner">
        <button id="openSettingsBtn" class="icon-btn" aria-label="Param√®tres">‚öôÔ∏è</button>
      </header>

      <!-- Onglet stats -->
      <div id="homeStats">
        <div class="card">
          <h3>Joueuse</h3>
          <p><strong>Pseudo</strong> <span id="playerName"></span></p>
          <p><strong>Niveau</strong> <span id="globalLevel"></span></p>
          <p><strong>XP totale</strong> <span id="globalXp"></span></p>
          <div class="stat-row">
            <span class="stat-label"><strong>Temps pass√©</strong></span>
            <span class="stat-value" id="globalTimePretty">00h00mn</span>
          </div>
        </div>
      </div>

      <div id="homeObjectives">
        <div class="card">
          <h3>Objectifs</h3>

          <div class="subsection">
            <h4>Hebdomadaire</h4>
            <div class="segmented" id="weekLoadPicker">
              <button data-load="busy">Charg√©e</button>
              <button data-load="normal" class="active">Normale</button>
              <button data-load="light">L√©g√®re</button>
            </div>
            <div class="stat-row compact">
              <span class="stat-label">Hebdo</span>
              <span class="stat-value"><span id="weekXp"></span>/<span id="weekGoal"></span> XP</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="weekProgress">0%</div></div>
          </div>

          <div class="subsection" style="margin-top:12px;">
            <h4>Mensuel</h4>
            <div class="stat-row compact">
              <span class="stat-label">Mensuel</span>
              <span class="stat-value"><span id="monthXp"></span>/<span id="monthGoal"></span> XP</span>
            </div>
            <div class="progress-bar"><div class="progress-fill" id="monthProgress">0%</div></div>
          </div>

          <button id="openPerformanceBtn" class="ghost btn-block">üèÉüèΩ‚Äç‚ôÄÔ∏è‚Äç‚û°Ô∏è Performances pass√©es</button>
        </div>
      </div>

      <!-- Onglet mondes -->
      <div id="homeWorlds">
        <div class="card">
          <h3>Parcourir les mondes</h3>
          <div id="worldsList" class="worlds-grid"></div>
          <button class="btn-block" id="openAddWorldBtn">üåÑ Ajouter un monde</button>
        </div>

        <div id="addWorldModal" class="modal hidden" role="dialog" aria-modal="true">
          <div class="modal-content card">
            <h3>Cr√©er un monde</h3>

            <label>Nom du monde</label>
            <input id="worldNameInput" placeholder="Ex : Sport" />

            <label>Ic√¥ne (emoji)</label>
            <input id="worldIconInput" placeholder="Ex : üèÉ" />

            <label>R√®gle XP</label>
            <div class="inline">
              <input id="minutesBaseInput" type="number" min="1" inputmode="numeric" placeholder="Minutes" />
              <span>=</span>
              <input id="xpBaseInput" type="number" min="1" inputmode="numeric" placeholder="XP" />
            </div>

            <div class="actions">
              <button id="createWorldBtn">Cr√©er</button>
              <button id="cancelWorldBtn" class="ghost" type="button">Annuler</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- WORLD -->
    <section id="worldScreen" class="hidden stack">
      <header class="topbar">
        <button id="backHomeBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2 id="worldHeaderTitle"></h2>
        <button id="worldQuickSettingsBtn" class="icon-btn" aria-label="Param√®tres monde">‚öôÔ∏è</button>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="worldStats">üìä Stats</button>
        <button class="tab-btn" data-tab="worldInput">‚è±Ô∏è Saisie</button>
        <button class="tab-btn" data-tab="worldObjectives">üéØ Objectifs</button>
      </div>

      <div id="worldStats" class="tab-panel">
        <div class="card">
          <h3>Stats</h3>
          <p><strong>Niveau du monde</strong> <span id="worldLevel"></span></p>
          <p><strong>XP semaine</strong> <span id="worldWeekXp"></span></p>
          <p><strong>XP totale</strong> <span id="worldTotalXp"></span></p>
          <p><strong>R√®gle XP</strong> <span id="worldRuleText"></span></p>
          <div class="stat-row">
            <span class="stat-label"><strong>Temps total</strong></span>
            <span class="stat-value" id="worldTotalTime">00h00mn</span>
          </div>
        </div>
      </div>


      <div id="worldInput" class="tab-panel hidden">
        <div class="card">
          <h3>Saisir du temps</h3>
          <input id="timeMinutesInput" type="number" min="1" inputmode="numeric" placeholder="Minutes (ex : 45)" />
          <button class="btn-block" id="validateTimeBtn">Valider</button>
          <p class="hint" id="timePreview"></p>
        </div>

      <div class="card">
        <h3>Historique des saisies</h3>
        <div id="entriesList"></div>
        <p class="hint">Suppression possible uniquement pendant 24h.</p>
        </div>
      </div>
      <div id="worldObjectives" class="tab-panel hidden">
        <div class="card">
          <h3>Objectifs</h3>
          <div id="objectivesList"></div>
        </div>

        <div class="card">
          <h3>Ajouter un objectif</h3>

          <label>Type</label>
          <select id="objectiveTypeSelect">
            <option value="repeatable">üîÅ R√©p√©table</option>
            <option value="milestone">üìà Palier</option>
            <option value="unique">‚≠ê Unique</option>
          </select>

          <div id="objectiveFieldsRepeatable">
            <label>Nom</label>
            <input id="objNameInput" placeholder="Ex : Aller courir" />
            <label>R√©compense (XP)</label>
            <input id="objXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
          </div>

          <div id="objectiveFieldsUnique" class="hidden">
            <label>Nom</label>
            <input id="objNameUniqueInput" placeholder="Ex : Finir un marathon" />
            <label>R√©compense (XP)</label>
            <input id="objXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
          </div>

          <div id="objectiveFieldsMilestone" class="hidden">
            <label>Texte (2 parties)</label>
            <div class="inline">
              <input id="milestonePrefixInput" placeholder="Ex : Lire" />
              <input id="milestoneSuffixInput" placeholder="Ex : livres" />
            </div>

            <div class="card subtle">
              <p class="hint">Ajoute tes paliers dans l‚Äôordre (ex : 1 puis 5 puis 10). Le prochain palier appara√Ætra automatiquement.</p>
              <div class="inline">
                <input id="milestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier (ex : 1)" />
                <input id="milestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP (ex : 10)" />
              </div>
              <button id="addMilestoneStepBtn" class="ghost">‚ûï Ajouter palier</button>
              <div id="milestoneStepsPreview" class="steps-preview"></div>
            </div>

            <button id="createMilestoneObjectiveBtn">Cr√©er l‚Äôobjectif palier</button>
          </div>

          <button class="btn-block" id="createObjectiveBtn">Ajouter</button>
        </div>
        <!-- MODAL: Modifier objectif -->
        <div id="editObjectiveModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
          <div class="modal-content card">
            <h3 id="editObjectiveTitle">Modifier l‚Äôobjectif</h3>

            <label>Type</label>
            <select id="editObjectiveTypeSelect">
              <option value="repeatable">üîÅ R√©p√©table</option>
              <option value="milestone">üìà Palier</option>
              <option value="unique">‚≠ê Unique</option>
            </select>

            <div id="editObjectiveFieldsRepeatable">
              <label>Nom</label>
              <input id="editObjNameInput" placeholder="Ex : Aller courir" />
              <label>R√©compense (XP)</label>
              <input id="editObjXpInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 20" />
            </div>

            <div id="editObjectiveFieldsUnique" class="hidden">
              <label>Nom</label>
              <input id="editObjNameUniqueInput" placeholder="Ex : Finir un marathon" />
              <label>R√©compense (XP)</label>
              <input id="editObjXpUniqueInput" type="number" min="1" inputmode="numeric" placeholder="Ex : 200" />
            </div>

            <div id="editObjectiveFieldsMilestone" class="hidden">
              <label>Texte (2 parties)</label>
              <div class="inline">
                <input id="editMilestonePrefixInput" placeholder="Ex : Lire" />
                <input id="editMilestoneSuffixInput" placeholder="Ex : livres" />
              </div>

              <div class="card subtle">
                <p class="hint">Modifie les paliers : tu peux vider puis re-ajouter si besoin.</p>
                <div class="inline">
                  <input id="editMilestoneCountInput" type="number" min="1" inputmode="numeric" placeholder="Palier (ex : 1)" />
                  <input id="editMilestoneXpInput" type="number" min="1" inputmode="numeric" placeholder="XP (ex : 10)" />
                </div>
                <button id="editAddMilestoneStepBtn" class="ghost">‚ûï Ajouter palier</button>
                <div id="editMilestoneStepsPreview" class="steps-preview"></div>
              </div>

              <button id="editSaveMilestoneBtn">Enregistrer l‚Äôobjectif palier</button>
            </div>

            <div class="actions">
              <button id="editSaveObjectiveBtn">Enregistrer</button>
              <button id="editCancelObjectiveBtn" class="ghost" type="button">Annuler</button>
            </div>
          </div>
        </div>

      </div>
    </section>
    
    <!-- Onglet performances -->
    <section id="performanceScreen" class="hidden">
      <header class="topbar">
        <button id="backFromPerformanceBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2>üèÉüèΩ‚Äç‚ôÄÔ∏è‚Äç‚û°Ô∏è Performances pass√©es</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="tabs">
        <button class="tab-btn active" data-tab="perfWeek">Semaine</button>
        <button class="tab-btn" data-tab="perfMonth">Mois</button>
      </div>

      <div id="perfWeek" class="tab-panel">
        <div class="card">
          <h3>Historique (Semaine)</h3>
          <div id="perfWeekList"></div>
        </div>
      </div>

      <div id="perfMonth" class="tab-panel hidden">
        <div class="card">
          <h3>Historique (Mois)</h3>
          <div id="perfMonthList"></div>
        </div>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="settingsScreen" class="hidden stack">
      <header class="topbar">
        <button id="backFromSettingsBtn" class="icon-btn" aria-label="Retour">‚Üê</button>
        <h2>‚öôÔ∏è Param√®tres</h2>
        <div style="width:40px;"></div>
      </header>

      <div class="card">
        <h3>Compte</h3>

        <p><strong>Pseudo</strong> <span id="accountPseudoLine">‚Äî</span></p>
        <p><strong>Email</strong> <span id="accountEmailLine">‚Äî</span></p>

        <button id="btnLogout" class="danger-btn btn-block">Se d√©connecter</button>
      </div>

      <div class="card">
        <h3>Objectifs</h3>
        <label>Objectif mensuel (XP)</label>
        <input id="monthGoalInput" type="number" min="1" inputmode="numeric" />

        <label>Objectifs hebdo (XP)</label>
        <div class="grid-3">
          <div>
            <div class="hint">Semaine charg√©e</div>
            <input id="weekGoalBusyInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine normale</div>
            <input id="weekGoalNormalInput" type="number" min="1" inputmode="numeric" />
          </div>
          <div>
            <div class="hint">Semaine l√©g√®re</div>
            <input id="weekGoalLightInput" type="number" min="1" inputmode="numeric" />
          </div>
        </div>
        <button class="btn-block" id="saveGoalsBtn">Enregistrer</button>
      </div>

      <div class="card">
        <h3>Mondes</h3>

        <div class="subsection">
          <h4>Mondes actifs</h4>
          <div id="manageWorldsActiveList"></div>
        </div>

        <div class="subsection" style="margin-top:12px;">
          <h4>Mondes archiv√©s</h4>
          <div id="manageWorldsArchivedList"></div>
        </div>
      </div>

      <div class="card danger">
        <h3>R√©initialiser</h3>
        <p class="hint">Supprime toutes les donn√©es (pseudo, mondes, XP‚Ä¶).</p>
        <button id="resetGameBtn" class="btn-block danger-btn">üëæ R√©initialiser le jeu</button>
      </div>
    </section>

    <!-- MODAL: Modifier monde -->
    <div id="manageWorldModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="modal-content card">
        <h3 id="manageWorldTitle">Modifier monde</h3>

        <div class="actions">
          <button id="mwToggleBtn" class="ghost">D√©sactiver</button>
          <button id="mwRuleBtn" class="ghost">R√®gle XP</button>
        </div>

        <button id="mwDeleteBtn" class="danger-btn btn-block">üóëÔ∏è Supprimer le monde</button>

        <button id="mwCloseBtn" class="ghost btn-block" type="button">Fermer</button>
      </div>
    </div>

    <!-- POPUP -->
    <div id="popup"></div>

  </div>

  <!-- DIALOG (remplace alert/confirm) -->
  <div id="dialogModal" class="modal hidden" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal-content card dialog-card">
      <h3 id="dialogTitle">Confirmation</h3>
      <p id="dialogMessage" class="dialog-message"></p>

      <div id="dialogInputWrap" class="dialog-input-wrap hidden">
        <input id="dialogInput" type="text" class="time-input" />
      </div>

      <div class="actions">
        <button id="dialogCancelBtn" class="ghost" type="button">Annuler</button>
        <button id="dialogOkBtn" type="button">Confirmer</button>
      </div>
    </div>
  </div>

  <!-- Firebase Core -->
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCQKK5pD8_h_Pg1-48spGBGzxZm1fgiHzs",
      authDomain: "joue-ma-vie.firebaseapp.com",
      projectId: "joue-ma-vie",
      storageBucket: "joue-ma-vie.firebasestorage.app",
      messagingSenderId: "351248369885",
      appId: "1:351248369885:web:7a2191fab089c60304b334"
    };

    firebase.initializeApp(firebaseConfig);
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js');
    }
  </script>
  <script src="js/main.js"></script>
  <div style="opacity:0.6;font-size:12px;text-align:center;margin-top:10px;">
  Version: <span id="appVersion"></span>
  </div>
</body>
</html>
